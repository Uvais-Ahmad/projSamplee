<link rel="stylesheet" href="/css/home.css">
<h2>Codial / <%= title %></h2>
<section id="feed-posts">
    
    <!-- Apply condition Only Auth user can post -->
    <h3>Posts</h3>
    <% if(locals.user){ %> 
        <form action="/posts/create" id="new-post-form" method="POST">
            <textarea id="content" name="content" cols="43" rows="4" placeholder="write post here..."></textarea><br>
            <input type="submit" value="Post" id="post-btn">
        </form>
    <% } %> 
</section>

<section id="posts">
    <% for( let p of posts){  %> 
        <div id="post">

            <!-- this deletion Shows Only when the user logged In and oNLY valid for users own post -->
            <% if( locals.user && p.user.id == locals.user.id ) { %> 
                
                <small>
                    <a href="/posts/destroy/<%= p.id %> ">X</a>
                </small>
            
            <% } %> 
            <h3 id="cont">
                <%= p.content %> <br>
            </h3>
            <h4 id="user">
                <%= p.user.name %><br>
            </h4>

            <div id="comment-container">
                <h1 id="tag">Comments :</h1>
                <div id="post-comments-list">
                    <% for(comment of p.comments){ %>
                        <!-- A post's user and a comment comment user both can delete own commnet or Own post comment -->
                        <% if( locals.user && locals.user.id == p.user.id  ) { %> 
                
                            <small>
                                <a href="/comments/destroy/<%=comment.id %> ">X</a>
                            </small>
                        
                        <% } %> 
                        <div class="comment">
                            <h4><%= comment.user.name %></h4>
                            <p><%= comment.content %></p>
                        </div>

                    <% } %> 
                </div>
            </div>
            
            <% if(locals.user){ %>
                <form action="/comments/create" method="POST" id="comment-form">
                    <input type="text" id="content" name="content" placeholder="Add a comment...">
                    <!-- This hidden sent the post id for the Comment it hiddenly transfer to server -->
                    <input type="hidden" name="post" value="<%= p._id %>">
                    <input type="submit" value="Post" id="comment-btn">
                </form>
            <% } %>
        </div>
    <% } %> 
</section>